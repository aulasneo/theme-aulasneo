<%page expression_filter="h"/>
<%inherit file="../main.html" />
<%namespace name='static' file='../static_content.html'/>
<%! from django.utils.translation import gettext as _ %>

<%block name="pagetitle">${_("Courses")}</%block>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = Array.from(document.querySelectorAll(".course-card"));
    const noCoursesMessage = document.getElementById("no-courses-message");
    const paginationContainer = document.querySelector(".pagination");
    const prevBtn = document.getElementById("prev-page");
    const nextBtn = document.getElementById("next-page");
    const searchInput = document.getElementById('discovery-input');

    let filteredCards = [];
    let currentPage = 1;
    const cardsPerPage = 4;

    function filterCards() {
      const searchText = searchInput.value.toLowerCase().trim();
      filteredCards = cards.filter(card => {
        const title = card.querySelector('.course-title')?.textContent.toLowerCase() || '';
        const organization = card.querySelector('.course-organization')?.textContent.toLowerCase() || '';
        const code = card.querySelector('.course-code')?.textContent.toLowerCase() || '';
        return (
          searchText === "" ||
          title.includes(searchText) ||
          organization.includes(searchText) ||
          code.includes(searchText)
        );
      });
    }

    function showPage(page) {
      cards.forEach(card => card.style.display = "none");
      const startIndex = (page - 1) * cardsPerPage;
      const endIndex = startIndex + cardsPerPage;
      filteredCards.slice(startIndex, endIndex).forEach(card => card.style.display = "flex");
    }

    function generatePaginationButtons(totalPages) {
      paginationContainer.innerHTML = '';
      const maxVisiblePages = 3;
      let startPage = Math.max(currentPage - Math.floor(maxVisiblePages / 2), 1);
      let endPage = startPage + maxVisiblePages - 1;

      if (endPage > totalPages) {
        endPage = totalPages;
        startPage = Math.max(endPage - maxVisiblePages + 1, 1);
      }

      for (let i = startPage; i <= endPage; i++) {
        const button = document.createElement("button");
        button.textContent = i;
        button.classList.add("pagination-btn");
        if (i === currentPage) button.classList.add("active");
        button.addEventListener("click", () => {
          currentPage = i;
          updatePagination();
        });
        paginationContainer.appendChild(button);
      }

      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    function updatePagination() {
      const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
      showPage(currentPage);
      generatePaginationButtons(totalPages);
      noCoursesMessage.style.display = filteredCards.length > 0 ? 'none' : 'flex';
    }

    function handleSearch(event) {
      event && event.preventDefault();
      currentPage = 1;
      filterCards();
      updatePagination();
    }

    searchInput.addEventListener("input", handleSearch);

    prevBtn.addEventListener("click", () => {
      if (currentPage > 1) {
        currentPage--;
        updatePagination();
      }
    });

    nextBtn.addEventListener("click", () => {
      const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        updatePagination();
      }
    });

    // InicializaciÃ³n
    filterCards();
    updatePagination();
  });
</script>

<main id="main" aria-label="Content" tabindex="-1">
  <section class="courses-container">
    <section id="discovery-courses" class="find-courses">
      <div class="filters-discovery">${_("Find the right course for you")}</div>
      <div class="filter-section-discovery">
        <div id="discovery-form" role="search" aria-label="course" class="custom-select-wrapper">
          <form class="wrapper-search-input" onsubmit="handleSearch(event)">
            <label for="discovery-input" class="sr">${_("Search for a course")}</label>
            <input id="discovery-input" class="discovery-input" placeholder="${_(" Search for a course")}" type="text" />
            <button type="submit" class="button postfix discovery-submit" title="${_(" Search")}">
              <svg class="searching" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35">
                <path
                  d="M 21 3 C 11.601563 3 4 10.601563 4 20 C 4 29.398438 11.601563 37 21 37 C 24.355469 37 27.460938 36.015625 30.09375 34.34375 L 42.375 46.625 L 46.625 42.375 L 34.5 30.28125 C 36.679688 27.421875 38 23.878906 38 20 C 38 10.601563 30.398438 3 21 3 Z M 21 7 C 28.199219 7 34 12.800781 34 20 C 34 27.199219 28.199219 33 21 33 C 13.800781 33 8 27.199219 8 20 C 8 12.800781 13.800781 7 21 7 Z">
                </path>
              </svg>
              <div aria-live="polite" aria-relevant="all">
                <div id="loading-indicator" class="loading-spinner hidden">
                  <span class="icon fa fa-spinner fa-spin" aria-hidden="true"></span>
                  <span class="sr">${_("Loading")}</span>
                </div>
              </div>
            </button>
          </form>
        </div>
      </div>
      <div class="courses">
        <ul class="courses-listing">
          % for course in courses:
          <li class="courses-listing-item course-card">
            <%include file="../course.html" args="course=course" />
          </li>
          % endfor
          <div id="no-courses-message" class="no-courses-message">${_("No courses found.")}</div>
        </ul>
        <div class="pagination-container">
          <div class="pagination-buttons">
            <button class="prevBtn" id="prev-page">
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAACq0lEQVR4nM1XyW4TQRBtaaq83EgOQeIChJ/gws6F9Sv4AeAPQAKR7c6JRQSkIC7gOK5yooEoiTjkAwgIDrkipsoyBzg1qradzbE9Y08kntTSuGemX3fNq1dl5/57bGyXC5TcQtIZIJlH1k82wjXpdFRr3HSxL+XGV6zrJJC8RNbfyPILWBeQdRZI7toI16xvkTWxZ4D1eZHk9PCMVV9E1jlk+Qus76OaXHKxh57Pxx4ikstIUrF3LDK2RjbS5eZxZFkHli+wlJzLumfg5AKQfEWWNUfNidSkwPoDSWoulmNuWFR0DFkYSL8PJg/hlfUWaZ+wpkXswcjDyRd8oedz9k0tvCOd9CAqOgYkW6b8Q++bEpHlTxBRzgBKzpvgiit65pCbljLyYdAiUb1xw216zEqOJItA+mL/7MZ22XJw0Glb6aWN9Erds2GWK0ja3GcyBU5umzn0ExSSPDZS4MZZNww2PZrJhIjtLqrT5j49SVlnkVSHJm0DSN8h61TntwOWN71UhyyP8iA1tK12fneCNAaSezsTnXmWh8jqkeUzsj7NNuTOwfWA5b5xpSF+cKTEQPI6mHqvUI8iqm6DepVeXKQzOYrryc6EFXEklX7GkEs6kUpEjWu7k7EvWXJbPU1jIGX+eSIrb1TXq10GYjA7syI+aAFrf7IXeGdaqQLrs64bxSU5FYrEgFMPg6guF0ORqOvk4btqNXJbVspyY63pOLB82yeqHo3AmhXvXBqBlqCWkXW1byMQQM0Ja1cC+Sgnr+m4kaZrfTqg5oSd3MJu38dlhOmkHd7V7CW06otmLCY4K+JWT/s2AJseWykjS+Ed+6YDw9sH1hKFVAsNvSZt95nb09DPhTlSsTy1lCmtJCddboh9yYq41VPzWyT9aCNcs05F3Lie61+Yo8I/4/g5+1QxRfMAAAAASUVORK5CYII="
                alt="circled-right-2">
            </button>
            <div class="pagination"></div>
            <button class="nextBtn" id="next-page">
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoklEQVR4nM1Xu24TURBdae947Y6kMAUFED6BhoY3Dc+vgA8A/gAqYmJqKh4iIAXRgLE9Y0cLkRNR5AMICIrUsDMrU0C1aK4jsLH36Y3Eka60ujt3j2fumYcd57/H1m6tgsFVQLlvkFeB5L0u+4zScLvhFcePqqXxeT1ZMshPgeQHEH83JGtAsmKQb+qyzyQvgSRQG0Py2EM+WpyxHXlA0gTiX4bktdvls44fmVh7PzIu8jlAbukZjYx+Ix9pf3gQiDcN8UfTCU7m/c2GgtMG+RMQDxwc1jOTGpKvgNx1fD7gFEVLFoCYDMqXdHIbXt4ckSaENSv8yCi59XwtqsTa6Z1qeOfy9F+0ZMEg76jyZ75XJQLxTyuikmEwOKWC89bl2IyXmjL8JvdX25Gn+Z1mBshvDcqTyd2t3ZrmYBFva/1vh4Ak1GtKsnOJzwPKcKLIVCi4psWhqKAA5bgtICgPYo22I1AbtxdeHj/Y0OrjzAFD4QlAEVs44mxQXgHJ8tghfhGruiKex4QdRqV2dfyAb5BvTRvyDSB5mG/xByCJgPjOlMfEt5UrC/H1OYjvphIb5OdJd1NiqJuG+Nn+iItkJUVc9/5saBMHFFbJ72s6obCL4cW/m35U1eTWfpqbFYf1TAWkJxemCohCy5k28dzE2xFMFIUYAHHbkDyaeuF1+IhtEkW8ToHb4zO2SfRkafavGg1yO9rKSmPtyqIh/jwhqphBYKDNu5RBYCSoPpBsJA4CFjis67hiyefxvCuLSppt9JlQKg807Ho/Tk6oTvbCu5GddDzsKA0VnDZx7aeJeW7VrSnDHXtG7zQ1vAnQkcimmh3oJdirPs2xgb5p91BY81RTproeHHZKgx9VNV+1n2q9BZR3uuwzybJL4aVS/8LsF34DOuc6Aq8U/akAAAAASUVORK5CYII="
                alt="circled-right-2">
            </button>
          </div>
        </div>
      </div>
    </section>
  </section>
</main>