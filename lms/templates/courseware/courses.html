<%page expression_filter="h"/>
<%inherit file="../main.html" />
<%namespace name='static' file='../static_content.html'/>
<%! from django.utils.translation import gettext as _ %>

<%block name="pagetitle">${_("Courses")}</%block>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = Array.from(document.querySelectorAll(".course-card"));
    const noCoursesMessage = document.getElementById("no-courses-message");
    const searchInput = document.getElementById('discovery-input');

    function filterCards() {
      const searchText = searchInput.value.toLowerCase().trim();
      let visibleCount = 0;
      cards.forEach(card => {
        const title = card.querySelector('.course-title')?.textContent.toLowerCase() || '';
        const organization = card.querySelector('.course-organization')?.textContent.toLowerCase() || '';
        const code = card.querySelector('.course-code')?.textContent.toLowerCase() || '';
        const matches = (
          searchText === "" ||
          title.includes(searchText) ||
          organization.includes(searchText) ||
          code.includes(searchText)
        );
        card.style.display = matches ? "flex" : "none";
        if (matches) visibleCount++;
      });
      noCoursesMessage.style.display = visibleCount > 0 ? 'none' : 'flex';
    }

    function handleSearch(event) {
      event && event.preventDefault();
      filterCards();
    }

    searchInput.addEventListener("input", handleSearch);

    // Inicializaci√≥n
    filterCards();
  });
</script>

<main id="main" aria-label="Content" tabindex="-1">
  <div class="line-header"></div>
  <section class="courses-container">
    <section id="discovery-courses" class="find-courses">
      <div class="filters-discovery">${_("Find the right course for you")}</div>
      <div class="filter-section-discovery">
        <div id="discovery-form" role="search" aria-label="course" class="custom-select-wrapper">
          <form class="wrapper-search-input" onsubmit="handleSearch(event)">
            <label for="discovery-input" class="sr">${_("Search for a course")}</label>
            <input id="discovery-input" class="discovery-input" placeholder="${_(" Search for a course")}" type="text" />
            <button type="submit" class="button postfix discovery-submit" title="${_(" Search")}">
              <svg class="searching" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35">
                <path
                  d="M 21 3 C 11.601563 3 4 10.601563 4 20 C 4 29.398438 11.601563 37 21 37 C 24.355469 37 27.460938 36.015625 30.09375 34.34375 L 42.375 46.625 L 46.625 42.375 L 34.5 30.28125 C 36.679688 27.421875 38 23.878906 38 20 C 38 10.601563 30.398438 3 21 3 Z M 21 7 C 28.199219 7 34 12.800781 34 20 C 34 27.199219 28.199219 33 21 33 C 13.800781 33 8 27.199219 8 20 C 8 12.800781 13.800781 7 21 7 Z">
                </path>
              </svg>
              <div aria-live="polite" aria-relevant="all">
                <div id="loading-indicator" class="loading-spinner hidden">
                  <span class="icon fa fa-spinner fa-spin" aria-hidden="true"></span>
                  <span class="sr">${_("Loading")}</span>
                </div>
              </div>
            </button>
          </form>
        </div>
      </div>
      <div class="courses">
        <ul class="courses-listing">
          % for course in courses:
          <li class="courses-listing-item course-card">
            <%include file="../course.html" args="course=course" />
          </li>
          % endfor
          <div id="no-courses-message" class="no-courses-message">${_("No courses found.")}</div>
        </ul>
      </div>
    </section>
  </section>
</main>